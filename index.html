<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
 <div class="panel panel-success" style="height:100%">
   <div class="panel-heading">Fovea Application</div>
  <div class="panel-body">
    <center>
      <h1> Welcome to our EHR Page</h1>
    </center>
     <h2>Practitioner Profile</h2>
      <table>
         <tr>
          <th>First name and Last name :</th>
          <td id='name'></td>
        </tr>
        <tr>
          <th>ID :</th>
          <td id='id'></td>
        </tr>
         <tr>
          <th>Email :</th>
          <td id='email'></td>
        </tr>
        
      </table>
   </div>
</div>

 <script src='example-smart-app.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- FHIR Client JS Library -->
    <script src='fhir-client-v0.1.12.js'></script>

    <!-- Prevent session bleed caused by single threaded embedded browser and sessionStorage API -->
    <!-- https://github.com/cerner/fhir-client-cerner-additions -->
    <script src='fhir-client-cerner-additions-1.0.0.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    
    <script>
      
        function onReady(smart)  {
            var url = smart.server.serviceUrl;
      //getting the access token
      var token = smart.server.auth.token;
        var arr=token.split('.');
        var head = arr[0];
        var load = arr[1];
        //getting the id token(response token)
       var idtoken=smart.tokenResponse.id_token;
       //var accesstoken=smart.server.access.token;
       var array = idtoken.split('.');
       var header = window.atob(array[0]);
       var payload = window.atob(array[1]);
       var res = header + payload;
       var obj1 = JSON.parse(payload);
        var text="Bearer "+token;
    // document.getElementById("demo").innerHTML = obj1.name + ", " + obj.sub + "," + obj.profile
         var settings = {
               "async": true,
               "crossDomain": true,
               "url": obj1.fhirUser,
               "method": "GET",
               "headers": {
                   "Accept": "application/json+fhir",
                   "header": head,
                   "Authorization": text,
                   "Cache-Control": "no-cache",
                  // "Postman-Token": "9f1488d2-1096-4acf-b052-bb1721519dfd"
               }
           }
           var id;
           $.ajax(settings).done(function (response) {
               console.log(response);
             console.log(smart.tokenResponse);
             id=response.id;
           });
        });
        //Display 'Failed to call FHIR Service' if extractData failed
        function() {
          $('#loading').hide();
          $('#errors').html('<p> Failed to call FHIR Service </p>');
        }
      );
     
    </script>
</body>
